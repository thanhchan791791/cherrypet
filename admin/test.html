<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Qu·∫£n l√Ω th√∫ - Giao di·ªán hi·ªán ƒë·∫°i</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
   /* ===== Reset ===== */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Poppins', Arial, sans-serif;
  background: linear-gradient(135deg, #fdfbfb, #e0f7fa);
  display: flex;
  flex-direction: column;       /* X·∫øp theo c·ªôt */
  justify-content: center;      /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
  align-items: center;          /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
  padding: 20px;
  color: #333;
  min-height: 100vh;
  overflow-x: hidden;
}

/* ===== Sections ===== */
section {
  background: #fff;
  padding: 24px;
  border-radius: 24px;
  width: 100%;
  max-width: 480px;
  margin-bottom: 30px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.12);
  transition: all 0.5s ease;
  opacity: 1;
  transform: translateY(0);
}
section.hidden {
  opacity: 0;
  transform: translateY(30px);
  pointer-events: none;
}

/* ===== Headings ===== */
h2 { font-size: 1.8rem; margin-bottom: 12px; color: #333; text-align: center; }
h3 { font-size: 1.4rem; margin-bottom: 12px; }
h4 { font-size: 1.2rem; margin-bottom: 8px; }

/* ===== Buttons ===== */
button {
  cursor: pointer;
  border: none;
  border-radius: 14px;
  padding: 14px 20px;
  font-weight: 600;
  font-size: 1rem;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
button:hover { transform: scale(1.05); }
button:active { transform: scale(0.98); }

.btn-primary { background: #ff9ff3; color: #fff; }
.btn-primary:hover { background: #f368e0; }
.btn-danger { background: #ee5253; color: #fff; }
.btn-danger:hover { background: #c23616; }
.btn-update { background: #feca57; color: #fff; }
.btn-update:hover { background: #ff9f43; }
.btn-show { background: #54a0ff; color: #fff; margin-bottom: 12px; }
.btn-show:hover { background: #2e86de; }
.back-btn { background: #48dbfb; margin-bottom: 20px; }
.back-btn:hover { background: #00a8ff; }

/* ===== Inputs ===== */
input[type="text"] {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: 1px solid #ccc;
  margin-bottom: 14px;
  font-size: 1rem;
  transition: all 0.3s ease;
}
input[type="text"]:focus { border-color: #54a0ff; outline: none; }

/* ===== Lists ===== */
ul { list-style: none; padding: 0; margin: 12px 0; }
ul li {
  background: #fefefe;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  transition: all 0.3s ease;
}
ul li:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }

/* ===== Table ===== */
#instance-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 16px;
  border-radius: 16px;
  overflow: auto;  /* scroll ngang khi mobile */
  display: block;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}
th, td { padding: 14px; text-align: left; font-size: 1rem; white-space: nowrap; }
th { background: #ff9ff3; color: #fff; font-weight: 600; }
td { background: #fff; }
td button { margin-left: 6px; }

/* ===== Hidden ===== */
.hidden { display: none; }

/* ===== Notification Toast ===== */
#toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) translateY(30px);
  background: rgba(0,0,0,0.85);
  color: #fff;
  padding: 16px 24px;
  border-radius: 16px;
  font-size: 1rem;
  font-weight: 600;
  opacity: 0;
  pointer-events: none;
  transition: all 0.5s ease;
  z-index: 1000;
}
#toast.show { opacity: 1; transform: translate(-50%, -50%) translateY(0); }

/* ===== Modal Form ===== */
.modal-overlay {
  position: fixed;
  top:0; left:0; width:100%; height:100%;
  background: rgba(0,0,0,0.4);
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s ease;
  padding: 16px;   /* tr√°nh s√°t l·ªÅ mobile */
  z-index: 999;
}
.modal-overlay.show {
  opacity: 1;
  pointer-events: all;
}
.modal {
  background: #fff;
  border-radius: 20px;
  padding: 24px;
  width: 100%;
  max-width: 400px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  transform: translateY(-30px);
  transition: all 0.3s ease;
}
.modal.show { transform: translateY(0); }
.modal h3 { margin-bottom: 16px; }
.modal input { margin-bottom: 12px; }
.modal .modal-close {
  background: #ee5253;
  color: #fff;
  float: right;
  margin-top: -8px;
}

/* ===== Branch Cards ===== */
#branch-list {
  display: flex;
  justify-content: center;
  gap: 20px;
  flex-wrap: wrap;
  margin-top: 20px;
}
#branch-list li {
  background: #54a0ff;
  border-radius: 24px;
  width: 140px;
  height: 140px;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #fff;
  font-size: 1.1rem;
  font-weight: 600;
  box-shadow: 0 6px 18px rgba(0,0,0,0.15);
  transition: all 0.4s ease;
  opacity: 0;
  transform: translateY(30px);
  cursor: pointer;
  flex-direction: column;
  text-align: center;
}
#branch-list li.show {
  opacity: 1;
  transform: translateY(0);
}
#branch-list li:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 10px 20px rgba(0,0,0,0.2);
  background: #2e86de;
}

/* ===== Responsive Mobile ===== */
@media(max-width: 480px){
  section { padding: 20px; max-width: 95%; }
  input[type="text"] { padding: 12px; font-size: 1rem; }
  button { padding: 12px 18px; font-size: 1rem; }
  th, td { padding: 12px; font-size: 0.95rem; }
  #branch-list li { width: 120px; height: 120px; font-size: 1rem; }
  #instance-table { display: block; overflow-x: auto; }
}

  </style>
</head>
<body>

  <!-- Toast notification -->
  <div id="toast"></div>

  <!-- Step 1 -->
  <section id="step-branch">
    <h2>üè¢ Ch·ªçn chi nh√°nh</h2>
    <ul id="branch-list">
      <li data-branch="Saigon"><i class="fas fa-city fa-2x"></i> S√†i G√≤n</li>
      <li data-branch="Dalat"><i class="fas fa-mountain fa-2x"></i> ƒê√† L·∫°t</li>
    </ul>
  </section>

  <!-- Step 2 -->
  <section id="step-animals" class="hidden">
    <button class="back-btn" id="back-to-branch"><i class="fas fa-arrow-left"></i> Quay l·∫°i chi nh√°nh</button>
    <h2>Chi nh√°nh: <span id="branch-name"></span></h2>
    <h3>üêæ Danh s√°ch th√∫</h3>
    <ul id="animal-list"></ul>
    <button class="btn-show" id="show-add-animal-form"><i class="fas fa-plus"></i> Th√™m th√∫ m·ªõi</button>
  </section>

  <!-- Step 3 -->
  <section id="step-animal-detail" class="hidden">
    <button class="back-btn" id="back-to-animals"><i class="fas fa-arrow-left"></i> Quay l·∫°i danh s√°ch th√∫</button>
    <h2>Chi nh√°nh: <span id="detail-branch-name"></span></h2>
    <h3>üê∂ Th√∫: <span id="detail-animal-name"></span></h3>

    <h4>Thu·ªôc t√≠nh</h4>
    <ul id="attr-list"></ul>
    <button class="btn-show" id="show-add-attr-form"><i class="fas fa-plus"></i> Th√™m thu·ªôc t√≠nh</button>

    <h4>T·ª´ng con th√∫</h4>
    <button class="btn-show" id="show-add-instance-form"><i class="fas fa-plus"></i> Th√™m/C·∫≠p nh·∫≠t con th√∫</button>
    <table id="instance-table">
      <thead>
        <tr id="instance-header"></tr>
      </thead>
      <tbody id="instance-body"></tbody>
    </table>
  </section>

  <!-- ===== Modal Forms ===== -->
  <div class="modal-overlay" id="modal-animal">
    <div class="modal">
      <button class="modal-close" id="close-modal-animal">ƒê√≥ng</button>
      <h3>Th√™m th√∫ m·ªõi</h3>
      <input type="text" id="new-animal-name" placeholder="T√™n th√∫ m·ªõi..." />
      <button class="btn-primary" id="add-animal-btn"><i class="fas fa-plus-circle"></i> Th√™m th√∫</button>
    </div>
  </div>

  <div class="modal-overlay" id="modal-attr">
    <div class="modal">
      <button class="modal-close" id="close-modal-attr">ƒê√≥ng</button>
      <h3>Th√™m thu·ªôc t√≠nh</h3>
      <input type="text" id="new-attr-name" placeholder="T√™n thu·ªôc t√≠nh m·ªõi..." />
      <button class="btn-primary" id="add-attr-btn"><i class="fas fa-plus-circle"></i> Th√™m thu·ªôc t√≠nh</button>
    </div>
  </div>

  <div class="modal-overlay" id="modal-instance">
    <div class="modal">
      <button class="modal-close" id="close-modal-instance">ƒê√≥ng</button>
      <h3>Th√™m / C·∫≠p nh·∫≠t con th√∫</h3>
      <form id="add-instance-form">
        <div id="instance-inputs"></div>
        <button type="submit" class="btn-primary"><i class="fas fa-save"></i> L∆∞u</button>
      </form>
    </div>
  </div>

  <script>
    // ===== Data =====
    const data = {
      Saigon: { animals: { Cho: { attributes: ['T√™n','Tu·ªïi','M√†u'], instances: [{'T√™n':'Boy','Tu·ªïi':'3','M√†u':'N√¢u'},{'T√™n':'Rio','Tu·ªïi':'2','M√†u':'ƒêen'}] }, Meo: { attributes:['T√™n','Tu·ªïi','Gi·ªëng'], instances:[{'T√™n':'Miu','Tu·ªïi':'1','Gi·ªëng':'Ba T∆∞'}] } } },
      Dalat: { animals: { Corgi: { attributes:['T√™n','Tu·ªïi'], instances:[{'T√™n':'Lego','Tu·ªïi':'4'},{'T√™n':'Dumbo','Tu·ªïi':'1'}] } } }
    };
    let currentBranch=null,currentAnimal=null,editIndex=-1;

    // ===== Elements =====
    const stepBranch=document.getElementById('step-branch');
    const stepAnimals=document.getElementById('step-animals');
    const stepAnimalDetail=document.getElementById('step-animal-detail');
    const branchList=document.querySelectorAll('#branch-list li');
    const branchNameSpan=document.getElementById('branch-name');
    const animalList=document.getElementById('animal-list');
    const detailBranchNameSpan=document.getElementById('detail-branch-name');
    const detailAnimalNameSpan=document.getElementById('detail-animal-name');
    const attrList=document.getElementById('attr-list');
    const instanceHeader=document.getElementById('instance-header');
    const instanceBody=document.getElementById('instance-body');
    const instanceInputsDiv=document.getElementById('instance-inputs');
    const addInstanceForm=document.getElementById('add-instance-form');
    const toast=document.getElementById('toast');

    const modalAnimal=document.getElementById('modal-animal');
    const modalAttr=document.getElementById('modal-attr');
    const modalInstance=document.getElementById('modal-instance');

    const newAnimalNameInput=document.getElementById('new-animal-name');
    const addAnimalBtn=document.getElementById('add-animal-btn');
    const newAttrNameInput=document.getElementById('new-attr-name');
    const addAttrBtn=document.getElementById('add-attr-btn');

    // ===== Toast =====
    function showToast(msg){ toast.textContent=msg; toast.classList.add('show'); setTimeout(()=>{ toast.classList.remove('show'); },2000); }

    // ===== Modal control =====
    document.getElementById('show-add-animal-form').onclick = () => { modalAnimal.classList.add('show'); modalAnimal.querySelector('.modal').classList.add('show'); };
    document.getElementById('close-modal-animal').onclick = () => { modalAnimal.classList.remove('show'); modalAnimal.querySelector('.modal').classList.remove('show'); };
    document.getElementById('show-add-attr-form').onclick = () => { modalAttr.classList.add('show'); modalAttr.querySelector('.modal').classList.add('show'); };
    document.getElementById('close-modal-attr').onclick = () => { modalAttr.classList.remove('show'); modalAttr.querySelector('.modal').classList.remove('show'); };
    document.getElementById('show-add-instance-form').onclick = () => { renderInstanceForm(data[currentBranch].animals[currentAnimal].attributes); modalInstance.classList.add('show'); modalInstance.querySelector('.modal').classList.add('show'); };
    document.getElementById('close-modal-instance').onclick = () => { modalInstance.classList.remove('show'); modalInstance.querySelector('.modal').classList.remove('show'); };

    // ===== Branch selection with animation =====
    branchList.forEach((li,index)=>{
      setTimeout(()=> li.classList.add('show'), index * 300); // stagger animation
      li.addEventListener('click',()=>{
        currentBranch=li.dataset.branch;
        branchNameSpan.textContent=currentBranch;
        stepBranch.classList.add('hidden');
        stepAnimals.classList.remove('hidden');
        renderAnimalList();
      });
    });
    document.getElementById('back-to-branch').onclick=()=>{ currentBranch=null; stepAnimals.classList.add('hidden'); stepBranch.classList.remove('hidden'); };

    // ===== Animal List =====
    function renderAnimalList(){
      animalList.innerHTML='';
      const animals=data[currentBranch]?.animals||{};
      if(Object.keys(animals).length===0){ animalList.innerHTML='<li>Ch∆∞a c√≥ th√∫ n√†o.</li>'; return; }
      for(const name in animals){
        const li=document.createElement('li');
        const span=document.createElement('span'); span.textContent=name; li.appendChild(span);
        const btnDetail=document.createElement('button'); btnDetail.innerHTML='<i class="fas fa-cog"></i> Qu·∫£n l√Ω'; btnDetail.classList.add('btn-update');
        btnDetail.addEventListener('click',()=>{ currentAnimal=name; openAnimalDetail(); });
        const btnDelete=document.createElement('button'); btnDelete.innerHTML='<i class="fas fa-trash-alt"></i> X√≥a'; btnDelete.classList.add('btn-danger');
        btnDelete.addEventListener('click',()=>{ if(confirm(`X√≥a th√∫ "${name}"?`)){ delete data[currentBranch].animals[name]; renderAnimalList(); showToast(`ƒê√£ x√≥a th√∫ "${name}"`); }}); 
        li.appendChild(btnDetail); li.appendChild(btnDelete); animalList.appendChild(li);
      }
    }

    // ===== Add Animal =====
    addAnimalBtn.onclick=()=>{
      const newName=newAnimalNameInput.value.trim();
      if(!newName) return alert('Nh·∫≠p t√™n th√∫ m·ªõi!');
      if(data[currentBranch].animals[newName]) return alert('Th√∫ ƒë√£ t·ªìn t·∫°i!');
      data[currentBranch].animals[newName]={attributes:[],instances:[]};
      newAnimalNameInput.value='';
      modalAnimal.classList.remove('show'); modalAnimal.querySelector('.modal').classList.remove('show');
      renderAnimalList(); showToast(`ƒê√£ th√™m th√∫ "${newName}"`);
    };

    // ===== Animal Detail =====
    function openAnimalDetail(){
      detailBranchNameSpan.textContent=currentBranch; detailAnimalNameSpan.textContent=currentAnimal;
      stepAnimals.classList.add('hidden'); stepAnimalDetail.classList.remove('hidden');
      renderAnimalDetail();
    }
    document.getElementById('back-to-animals').onclick=()=>{ stepAnimalDetail.classList.add('hidden'); stepAnimals.classList.remove('hidden'); editIndex=-1; };

    function renderAnimalDetail(){
      const animalData=data[currentBranch].animals[currentAnimal];
      attrList.innerHTML='';
      if(animalData.attributes.length===0){ attrList.innerHTML='<li>Ch∆∞a c√≥ thu·ªôc t√≠nh n√†o.</li>'; }
      else{
        animalData.attributes.forEach(attr=>{
          const li=document.createElement('li'); const span=document.createElement('span'); span.textContent=attr; li.appendChild(span);
          const btnDelete=document.createElement('button'); btnDelete.innerHTML='<i class="fas fa-trash-alt"></i>'; btnDelete.classList.add('btn-danger');
          btnDelete.addEventListener('click',()=>{ if(confirm(`X√≥a thu·ªôc t√≠nh "${attr}"?`)){ const idx=animalData.attributes.indexOf(attr); if(idx>-1) animalData.attributes.splice(idx,1); animalData.instances.forEach(inst=>delete inst[attr]); renderAnimalDetail(); showToast(`ƒê√£ x√≥a thu·ªôc t√≠nh "${attr}"`); }});
          li.appendChild(btnDelete); attrList.appendChild(li);
        });
      }
      renderInstanceTable();
    }

    // ===== Add Attribute =====
    addAttrBtn.onclick=()=>{
      const newAttr=newAttrNameInput.value.trim();
      if(!newAttr) return alert('Nh·∫≠p t√™n thu·ªôc t√≠nh!');
      const animalData=data[currentBranch].animals[currentAnimal];
      if(animalData.attributes.includes(newAttr)) return alert('Thu·ªôc t√≠nh ƒë√£ t·ªìn t·∫°i!');
      animalData.attributes.push(newAttr);
      newAttrNameInput.value=''; modalAttr.classList.remove('show'); modalAttr.querySelector('.modal').classList.remove('show');
      renderAnimalDetail(); showToast(`ƒê√£ th√™m thu·ªôc t√≠nh "${newAttr}"`);
    };

    // ===== Instance Table =====
    function renderInstanceTable(){
      const animalData=data[currentBranch].animals[currentAnimal];
      instanceHeader.innerHTML=''; instanceBody.innerHTML='';
      animalData.attributes.forEach(attr=>{ const th=document.createElement('th'); th.textContent=attr; instanceHeader.appendChild(th); });
      const thAction=document.createElement('th'); thAction.textContent='Thao t√°c'; instanceHeader.appendChild(thAction);
      animalData.instances.forEach((inst,i)=>{
        const tr=document.createElement('tr');
        animalData.attributes.forEach(attr=>{ const td=document.createElement('td'); td.textContent=inst[attr]||''; tr.appendChild(td); });
        const tdAction=document.createElement('td');
        const btnEdit=document.createElement('button'); btnEdit.innerHTML='<i class="fas fa-edit"></i>'; btnEdit.classList.add('btn-update');
        btnEdit.onclick=()=>{ editIndex=i; renderInstanceForm(animalData.attributes, inst); modalInstance.classList.add('show'); modalInstance.querySelector('.modal').classList.add('show'); };
        const btnDelete=document.createElement('button'); btnDelete.innerHTML='<i class="fas fa-trash-alt"></i>'; btnDelete.classList.add('btn-danger');
        btnDelete.onclick=()=>{ if(confirm('X√≥a con th√∫ n√†y?')){ animalData.instances.splice(i,1); renderInstanceTable(); showToast('ƒê√£ x√≥a con th√∫'); } };
        tdAction.appendChild(btnEdit); tdAction.appendChild(btnDelete); tr.appendChild(tdAction);
        instanceBody.appendChild(tr);
      });
    }

    // ===== Instance Form =====
    function renderInstanceForm(attrs, dataInst=null){
      instanceInputsDiv.innerHTML='';
      attrs.forEach(attr=>{
        const input=document.createElement('input'); input.type='text'; input.placeholder=attr; input.name=attr;
        if(dataInst && dataInst[attr]) input.value=dataInst[attr];
        instanceInputsDiv.appendChild(input);
      });
    }
    addInstanceForm.onsubmit=(e)=>{
      e.preventDefault();
      const animalData=data[currentBranch].animals[currentAnimal];
      const newInst={};
      instanceInputsDiv.querySelectorAll('input').forEach(input=>{ newInst[input.name]=input.value; });
      if(editIndex>=0){ animalData.instances[editIndex]=newInst; editIndex=-1; showToast('ƒê√£ c·∫≠p nh·∫≠t con th√∫'); }
      else{ animalData.instances.push(newInst); showToast('ƒê√£ th√™m con th√∫ m·ªõi'); }
      modalInstance.classList.remove('show'); modalInstance.querySelector('.modal').classList.remove('show');
      renderInstanceTable();
    };
  </script>
</body>
</html>
